---
title: "ang-boxplot"
author: "Angeliki"
date: '2022-04-29'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Effect of treatment boxplots

CD3D, MS4A1, CTLA4, CD19 -> where shown to go back to normal
after treatment
IL10, CLEC12A, AURKA, MMP13, CLEC2B, CD58 -> are RA markers
and do not return to normal levels

Read treatment log data
```{r}
logfold_treatment <- read_tsv(
  file = "../data/03_treatment_log2fc.tsv")
all_conditions <- read_tsv(
  file = "../data/02_large_w_meta_clean.tsv")
```

Wrangle
From the logfolds select only important genes and make it 
into long format.

```{r}
logFC_treatment <- logfold_treatment %>% 
  select(id,
         CD3D,
         MS4A1,
         CTLA4,
         CD19,
         IL10,
         CLEC12A,
         AURKA,
         MMP13,
         CLEC2B,
         CD58
         ) %>% 
  pivot_longer(cols = -c(id),
               names_to = "Genes" , 
               values_to = "log2fc")

logFC_treatment
```

From the all_conditions select only normal tissues and
the important genes.


```{r}
healthy <- 
  all_conditions %>% 
  filter(disease == "Normal") %>% 
  select(id,
         CD3D,
         MS4A1,
         CTLA4,
         CD19,
         IL10,
         CLEC12A,
         AURKA,
         MMP13,
         CLEC2B,
         CD58
         )
```

For the healthy, calculate mean expression level
of each gene and do a logfold by this mean
```{r}

# transpose
healthy_transposed<- healthy %>%  
  pivot_longer(cols = -id, names_to = "Genes") %>% 
  pivot_wider(names_from = id,
              values_from = value) 

# add mean and calculate logFC
logFCs <- healthy_transposed %>% 
  mutate(mean_expression =
           rowMeans(across(
             where(is.numeric)
           )
           )
  ) %>% 
  transmute(across(
    !c(Genes, mean_expression),
    ~ log2(. + 1) - log2(mean_expression + 1)
  )
  )

# now combine the above and make it long 
logFC_healthy <-
  healthy_transposed %>% 
  select(Genes) %>% 
  bind_cols(logFCs) %>% 
  pivot_longer(cols = -Genes,
               names_to = "id")

logFC_healthy
```

Preparing to bind the treatment and healthy logFCs datasets
```{r}
logFC_healthy <-
  logFC_healthy %>% 
  dplyr::rename(log2fc = value) %>% 
  select(id, Genes, log2fc)

logFC_healthy
```
Binding the two datasets
```{r}
all_logFCs <-
  logFC_treatment %>% 
  bind_rows(logFC_healthy)
```

Visualize
```{r}
all_logFCs %>% 
  ggplot(mapping = aes(
    x = 
  ))
  
```

